<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ThriveConnect | Match Preview</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@500;700&family=Space+Grotesk:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --ink: #0f1b2b;
        --paper: #f6efe7;
        --accent: #e46a2c;
        --accent-2: #2e6f6f;
        --wash: #fde9d3;
        --stroke: rgba(15, 27, 43, 0.15);
        --shadow: 0 18px 40px rgba(15, 27, 43, 0.18);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(circle at 12% 10%, #fcd0b6 0 18%, transparent 18%),
          radial-gradient(circle at 90% 20%, #c7e5dd 0 16%, transparent 16%),
          radial-gradient(circle at 70% 85%, #f5b493 0 20%, transparent 20%),
          linear-gradient(120deg, var(--paper), #f8f2ea);
        background-attachment: fixed;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 48px 20px;
      }

      .shell {
        width: min(960px, 100%);
        display: grid;
        gap: 24px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        gap: 24px;
      }

      .brand {
        display: grid;
        gap: 8px;
      }

      .brand h1 {
        margin: 0;
        font-family: "Fraunces", "Times New Roman", serif;
        font-size: clamp(2.2rem, 3.6vw, 3.4rem);
        letter-spacing: -0.5px;
      }

      .brand p {
        margin: 0;
        max-width: 480px;
        font-size: 1.02rem;
        color: rgba(15, 27, 43, 0.75);
      }

      .progress {
        background: rgba(15, 27, 43, 0.08);
        border-radius: 999px;
        height: 10px;
        width: min(260px, 100%);
        position: relative;
        overflow: hidden;
      }

      .progress span {
        position: absolute;
        inset: 0;
        width: 10%;
        background: linear-gradient(90deg, var(--accent), #f7a53d);
        border-radius: inherit;
        transition: width 0.4s ease;
      }

      .card {
        background: white;
        border: 1px solid var(--stroke);
        border-radius: 28px;
        padding: clamp(24px, 4vw, 36px);
        box-shadow: var(--shadow);
        display: grid;
        gap: 24px;
        animation: lift 0.8s ease both;
        width: min(680px, 100%);
      }

      @keyframes lift {
        from {
          opacity: 0;
          transform: translateY(18px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .question {
        display: grid;
        gap: 16px;
      }

      .question h2 {
        margin: 0;
        font-size: clamp(1.4rem, 2vw, 1.9rem);
      }

      .question p {
        margin: 0;
        color: rgba(15, 27, 43, 0.7);
      }

      .options {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .option {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        border-radius: 18px;
        border: 1px solid var(--stroke);
        background: var(--paper);
        cursor: pointer;
        transition: transform 0.2s ease, border-color 0.2s ease;
        animation: fade-in 0.5s ease both;
      }

      .option:hover {
        transform: translateY(-2px);
        border-color: rgba(15, 27, 43, 0.35);
      }

      .option input {
        width: 18px;
        height: 18px;
        accent-color: var(--accent);
      }

      .option input[type="radio"] {
        appearance: none;
        width: 0;
        height: 0;
        margin: 0;
      }

      .option span {
        font-weight: 600;
      }

      @keyframes fade-in {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
      }

      .actions .buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .tag {
        font-size: 0.95rem;
        color: rgba(15, 27, 43, 0.65);
        background: var(--wash);
        border-radius: 999px;
        padding: 6px 12px;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 12px 22px;
        font-size: 1rem;
        font-weight: 600;
        font-family: inherit;
        background: linear-gradient(135deg, var(--accent), #f7a53d);
        color: white;
        cursor: pointer;
        box-shadow: 0 8px 18px rgba(228, 106, 44, 0.25);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      button.secondary {
        background: white;
        color: var(--ink);
        border: 1px solid rgba(15, 27, 43, 0.2);
        box-shadow: none;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 12px 22px rgba(228, 106, 44, 0.3);
      }

      .result {
        text-align: center;
        gap: 18px;
      }

      .result h2 {
        margin: 0;
        font-size: clamp(1.8rem, 2.6vw, 2.4rem);
      }

      .result img {
        width: min(280px, 100%);
        border-radius: 24px;
        border: 1px solid rgba(15, 27, 43, 0.12);
        box-shadow: 0 12px 30px rgba(15, 27, 43, 0.18);
      }

      .hidden {
        display: none;
      }

      .dev-panel {
        position: fixed;
        right: 14px;
        bottom: 14px;
        width: min(240px, 85vw);
        background: rgba(45, 45, 45, 0.55);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.2);
        padding: 10px;
        display: grid;
        gap: 8px;
        z-index: 10;
        color: #f1f1f1;
        font-family: "SF Mono", "Menlo", "Consolas", monospace;
      }

      .dev-panel header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .dev-panel h4 {
        margin: 0;
        font-size: 0.75rem;
        letter-spacing: 1px;
        text-transform: uppercase;
        opacity: 0.7;
      }

      .dev-panel .tools {
        display: grid;
        gap: 6px;
      }

      .dev-panel.collapsed .tools {
        display: none;
      }

      .dev-panel button {
        width: 100%;
        justify-content: center;
        border-radius: 8px;
        font-size: 0.78rem;
        padding: 8px 10px;
        background: rgba(255, 255, 255, 0.08);
        color: #f1f1f1;
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: none;
        text-transform: uppercase;
        letter-spacing: 0.6px;
      }

      .dev-panel button:hover:not(:disabled) {
        transform: none;
        box-shadow: none;
        background: rgba(255, 255, 255, 0.15);
      }

      @media (min-width: 860px) {
        .grid {
          display: grid;
          grid-template-columns: 1fr;
          gap: 24px;
          justify-items: center;
        }

        .grid.single {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <main class="shell">
      <header>
        <div class="brand">
          <h1>ThriveConnect</h1>
          <p>
            A calm, guided intake that turns real answers into therapist matches.
            Today is just a placeholder preview.
          </p>
        </div>
        <div class="progress" aria-label="Progress">
          <span id="progress-fill"></span>
        </div>
      </header>

      <section class="grid" id="layout">
        <form class="card" id="questionnaire" aria-label="Sample intake">
          <div class="question">
            <h2 id="question-label">Question 1</h2>
            <p id="question-prompt">Placeholder prompt for Question 1.</p>
          </div>

          <div class="options" id="options"></div>

          <div class="actions">
            <span class="tag" id="progress-label">Question 1 of 6</span>
            <div class="buttons">
              <button class="secondary" type="button" id="prev-button">
                Back
              </button>
              <button type="button" id="next-button">Next</button>
              <button type="submit" id="submit-button">Submit</button>
            </div>
          </div>
        </form>

        <section class="card result hidden" id="result">
          <h2 id="result-title">
            Congrats! We have matched you with Colter. They will be reaching out
            to you soon.
          </h2>
          <p id="result-description">
            This is a placeholder match screen. Later we'll show their bio and let
            them reach out to you.
          </p>
          <img
            id="result-photo"
            src="assets/colter.png"
            alt="Colter smiling portrait"
          />
        </section>
      </section>
    </main>

    <section class="dev-panel collapsed" id="dev-panel" aria-label="Dev tools">
      <header>
        <h4>Dev Tools</h4>
        <button type="button" class="secondary" id="toggle-dev-panel">
          Expand
        </button>
      </header>
      <div class="tools">
        <button type="button" id="start-over">Start Over</button>
      </div>
    </section>

    <script>
      const fallbackQuestions = [
        {
          id: "services",
          label: "Question 1",
          prompt: "What type of services are you interested in? (Select up to 3)",
          type: "multi",
          maxSelections: 3,
          options: [
            {
              id: "services_iop",
              label: "Intensive Outpatient Program (IOP)"
            },
            {
              id: "services_individual_adult",
              label: "Individual therapy (adult)"
            },
            {
              id: "services_individual_child",
              label: "Individual therapy (child/adolescent)"
            },
            { id: "services_couples", label: "Couples therapy" },
            {
              id: "services_ketamine",
              label: "Ketamine-Assisted Psychotherapy"
            },
            { id: "services_group", label: "Group therapy" }
          ]
        },
        {
          id: "primary_focus",
          label: "Question 2",
          prompt: "What’s the main thing you want help with right now? (Select 1)",
          type: "single",
          options: [
            { id: "primary_anxiety_depression", label: "Anxiety/Depression" },
            { id: "primary_ocd", label: "OCD" },
            { id: "primary_trauma", label: "Trauma" },
            {
              id: "primary_relationships_individual",
              label: "Relationship help (individual)"
            },
            {
              id: "primary_relationships_couples",
              label: "Relationship help (couples)"
            },
            { id: "primary_spiritual_trauma", label: "Spiritual trauma" },
            { id: "primary_child_support", label: "Child/adolescent support" },
            { id: "primary_substance_use", label: "Substance use" },
            { id: "primary_eating_disorder", label: "Eating disorder" },
            {
              id: "primary_personality_disorder",
              label: "Personality disorder"
            },
            { id: "primary_grief", label: "Grief" },
            { id: "primary_personal_growth", label: "Not sure / personal growth" }
          ]
        },
        {
          id: "secondary_focus",
          label: "Question 3",
          prompt: "Anything else you’d like to work on? (Select all that apply)",
          type: "multi",
          options: [
            { id: "secondary_anxiety_depression", label: "Anxiety/Depression" },
            { id: "secondary_ocd", label: "OCD" },
            { id: "secondary_trauma", label: "Trauma" },
            {
              id: "secondary_relationships_individual",
              label: "Relationship help (individual)"
            },
            {
              id: "secondary_relationships_couples",
              label: "Relationship help (couples)"
            },
            { id: "secondary_spiritual_trauma", label: "Spiritual trauma" },
            { id: "secondary_child_support", label: "Child/adolescent support" },
            { id: "secondary_substance_use", label: "Substance use" },
            { id: "secondary_eating_disorder", label: "Eating disorder" },
            {
              id: "secondary_personality_disorder",
              label: "Personality disorder"
            },
            { id: "secondary_grief", label: "Grief" },
            { id: "secondary_personal_growth", label: "Not sure / personal growth" }
          ]
        },
        {
          id: "therapist_gender",
          label: "Question 4",
          prompt: "Do you have a therapist gender preference?",
          type: "single",
          options: [
            { id: "gender_female_only", label: "Female only" },
            { id: "gender_prefer_female", label: "Prefer female" },
            { id: "gender_no_preference", label: "No preference" },
            { id: "gender_prefer_male", label: "Prefer male" },
            { id: "gender_male_only", label: "Male only" }
          ]
        },
        {
          id: "location_preference",
          label: "Question 5",
          prompt: "What location works best for you?",
          type: "single",
          options: [
            { id: "location_phoenix_only", label: "Phoenix only (Tatum & Shea)" },
            { id: "location_prefer_phoenix", label: "Prefer Phoenix" },
            { id: "location_either", label: "Either location" },
            { id: "location_prefer_glendale", label: "Prefer Glendale" },
            {
              id: "location_glendale_only",
              label: "Glendale only (75th Ave & Bell)"
            },
            { id: "location_virtual_only", label: "Virtual only" }
          ]
        },
        {
          id: "virtual_only_ok",
          label: "Question 6",
          prompt: "If your best match is virtual-only, would you be open to that?",
          type: "single",
          options: [
            { id: "virtual_yes_only", label: "Yes — virtual only" },
            {
              id: "virtual_yes_either",
              label: "Yes — either in-person or virtual"
            },
            { id: "virtual_no_in_person", label: "No — in-person only" }
          ]
        },
        {
          id: "insurance",
          label: "Question 7",
          prompt: "What insurance do you have?",
          type: "single",
          options: [
            { id: "insurance_bcbs", label: "BCBS" },
            { id: "insurance_aetna", label: "Aetna" },
            { id: "insurance_united", label: "United" },
            { id: "insurance_cigna", label: "Cigna" },
            { id: "insurance_medicare", label: "Medicare/Medicaid" },
            { id: "insurance_other", label: "Other / Not sure" }
          ]
        },
        {
          id: "out_of_network",
          label: "Question 8",
          prompt:
            "If your best match is out-of-network (doesn’t take your insurance), would you still like to be considered?",
          type: "single",
          options: [
            { id: "out_of_network_yes", label: "Yes" },
            { id: "out_of_network_no", label: "No" }
          ]
        },
        {
          id: "intern_clinician",
          label: "Question 9",
          prompt:
            "If cost is a concern, would you be open to seeing an intern clinician?",
          type: "single",
          options: [
            { id: "intern_yes", label: "Yes" },
            { id: "intern_no", label: "No" }
          ]
        }
      ];

      const state = {
        index: 0,
        answers: {},
        questions: [],
        therapists: []
      };

      const questionLabel = document.getElementById("question-label");
      const questionPrompt = document.getElementById("question-prompt");
      const optionsContainer = document.getElementById("options");
      const progressLabel = document.getElementById("progress-label");
      const progressFill = document.getElementById("progress-fill");
      const prevButton = document.getElementById("prev-button");
      const nextButton = document.getElementById("next-button");
      const submitButton = document.getElementById("submit-button");
      const questionnaire = document.getElementById("questionnaire");
      const result = document.getElementById("result");
      const resultTitle = document.getElementById("result-title");
      const resultDescription = document.getElementById("result-description");
      const resultPhoto = document.getElementById("result-photo");
      const layout = document.getElementById("layout");
      const devPanel = document.getElementById("dev-panel");
      const toggleDevPanel = document.getElementById("toggle-dev-panel");
      const startOverButton = document.getElementById("start-over");

      const fallbackTherapists = [
        {
          id: "t1",
          name: "Colter",
          credentials: "LMFT",
          specialties: ["Anxiety", "Relationships", "Life Transitions"],
          modalities: ["CBT", "Mindfulness"],
          gender: "male",
          services: [
            "services_individual_adult",
            "services_couples",
            "services_group"
          ],
          focuses: ["anxiety_depression", "relationships_individual", "grief"],
          locations: ["phoenix"],
          virtual: true,
          inPerson: true,
          virtualOnly: false,
          insurances: ["BCBS", "Aetna", "United"],
          outOfNetwork: true,
          isIntern: false,
          photoUrl: "assets/colter.png"
        },
        {
          id: "t2",
          name: "Riley Chen",
          credentials: "LCSW",
          specialties: ["Trauma", "OCD", "Substance Use"],
          modalities: ["ACT", "Somatic"],
          gender: "female",
          services: ["services_iop", "services_individual_adult"],
          focuses: ["trauma", "ocd", "substance_use"],
          locations: ["glendale"],
          virtual: false,
          inPerson: true,
          virtualOnly: false,
          insurances: ["Cigna", "Aetna"],
          outOfNetwork: false,
          isIntern: false,
          photoUrl:
            "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=600&q=80"
        },
        {
          id: "t3",
          name: "Jamie Rivera",
          credentials: "Intern",
          specialties: ["Child/Adolescent", "Anxiety", "Family Support"],
          modalities: ["Play Therapy", "CBT"],
          gender: "female",
          services: ["services_individual_child"],
          focuses: ["child_support", "anxiety_depression"],
          locations: [],
          virtual: true,
          inPerson: false,
          virtualOnly: true,
          insurances: ["BCBS"],
          outOfNetwork: true,
          isIntern: true,
          photoUrl:
            "https://images.unsplash.com/photo-1525134479668-1bee5c7c6845?auto=format&fit=crop&w=600&q=80"
        }
      ];

      const loadQuestions = async () => {
        try {
          const response = await fetch("../data/questions.json");
          if (!response.ok) {
            throw new Error("Failed to load questions");
          }
          const data = await response.json();
          if (Array.isArray(data) && data.length > 0) {
            return data;
          }
        } catch (error) {
          return fallbackQuestions;
        }
        return fallbackQuestions;
      };

      const loadTherapists = async () => {
        try {
          const response = await fetch("../data/therapists.json");
          if (!response.ok) {
            throw new Error("Failed to load therapists");
          }
          const data = await response.json();
          if (Array.isArray(data) && data.length > 0) {
            return data;
          }
        } catch (error) {
          return fallbackTherapists;
        }
        return fallbackTherapists;
      };

      const normalizeFocusId = (value) => {
        if (!value) {
          return null;
        }
        return value.replace(/^primary_/, "").replace(/^secondary_/, "");
      };

      const insuranceMap = {
        insurance_bcbs: "BCBS",
        insurance_aetna: "Aetna",
        insurance_united: "United",
        insurance_cigna: "Cigna",
        insurance_medicare: "Medicare/Medicaid"
      };

      const matchTherapists = (therapists, answers) => {
        const selectedServices = Array.isArray(answers.services)
          ? answers.services
          : [];
        const primaryFocus = normalizeFocusId(answers.primary_focus);
        const genderPreference = answers.therapist_gender;
        const locationPreference = answers.location_preference;
        const virtualPreference = answers.virtual_only_ok;
        const insuranceSelection = answers.insurance;
        const outOfNetwork = answers.out_of_network;
        const internPreference = answers.intern_clinician;

        return therapists.filter((therapist) => {
          if (selectedServices.length > 0) {
            const hasService = selectedServices.some((service) =>
              therapist.services?.includes(service)
            );
            if (!hasService) {
              return false;
            }
          }

          if (primaryFocus) {
            const hasPrimary = therapist.focuses?.includes(primaryFocus);
            if (!hasPrimary) {
              return false;
            }
          }

          if (genderPreference === "gender_female_only") {
            if (therapist.gender !== "female") {
              return false;
            }
          }

          if (genderPreference === "gender_male_only") {
            if (therapist.gender !== "male") {
              return false;
            }
          }

          if (locationPreference === "location_phoenix_only") {
            if (!therapist.locations?.includes("phoenix")) {
              return false;
            }
          }

          if (locationPreference === "location_glendale_only") {
            if (!therapist.locations?.includes("glendale")) {
              return false;
            }
          }

          if (locationPreference === "location_virtual_only") {
            if (!therapist.virtual) {
              return false;
            }
          }

          if (virtualPreference === "virtual_no_in_person") {
            if (therapist.virtualOnly) {
              return false;
            }
          }

          if (insuranceSelection && insuranceSelection !== "insurance_other") {
            const insuranceName = insuranceMap[insuranceSelection];
            const inNetwork = therapist.insurances?.includes(insuranceName);
            if (outOfNetwork === "out_of_network_no" && !inNetwork) {
              return false;
            }
            if (outOfNetwork === "out_of_network_yes") {
              if (!inNetwork && !therapist.outOfNetwork) {
                return false;
              }
            }
          }

          if (internPreference === "intern_no" && therapist.isIntern) {
            return false;
          }

          return true;
        });
      };

      const showResult = (match, matchCount) => {
        if (match) {
          resultTitle.textContent = `Congrats! We have matched you with ${match.name}. They will be reaching out to you soon.`;
          resultDescription.textContent = `${match.credentials} • ${match.specialties?.join(
            ", "
          )}`;
          resultPhoto.src = match.photoUrl || resultPhoto.src;
          resultPhoto.alt = `${match.name} portrait`;
          return;
        }

        resultTitle.textContent = "Thanks! We're reviewing your answers.";
        resultDescription.textContent =
          matchCount === 0
            ? "No exact matches were found with the current constraints."
            : "We'll follow up shortly with a recommendation.";
      };

      const submitQuestionnaire = () => {
        const therapistList =
          state.therapists.length > 0 ? state.therapists : fallbackTherapists;
        const matches = matchTherapists(therapistList, state.answers);
        showResult(matches[0], matches.length);
        questionnaire.classList.add("hidden");
        result.classList.remove("hidden");
        layout.classList.add("single");
      };

      const resetQuestionnaire = () => {
        state.index = 0;
        state.answers = {};
        questionnaire.classList.remove("hidden");
        result.classList.add("hidden");
        layout.classList.remove("single");
        renderQuestion();
      };

      const updateOptionDisabledStates = (question) => {
        if (!question || question.type !== "multi") {
          return;
        }
        const selectedValues = Array.isArray(state.answers[question.id])
          ? state.answers[question.id]
          : [];
        const maxSelections = question.maxSelections ?? null;
        const hasReachedMax =
          maxSelections && selectedValues.length >= maxSelections;

        optionsContainer
          .querySelectorAll(`input[name="${question.id}"]`)
          .forEach((input) => {
            input.disabled = hasReachedMax && !input.checked;
          });
      };

      const renderQuestion = () => {
        const question = state.questions[state.index];
        if (!question) {
          return;
        }

        questionLabel.textContent = question.label;
        questionPrompt.textContent = question.prompt;
        optionsContainer.innerHTML = "";

        const isMulti = question.type === "multi";
        const selectedValues = Array.isArray(state.answers[question.id])
          ? state.answers[question.id]
          : state.answers[question.id]
          ? [state.answers[question.id]]
          : [];

        question.options.forEach((option) => {
          const label = document.createElement("label");
          label.className = "option";

          const input = document.createElement("input");
          input.type = isMulti ? "checkbox" : "radio";
          input.name = question.id;
          input.value = option.id;
          input.checked = selectedValues.includes(option.id);

          input.addEventListener("change", () => {
            if (isMulti) {
              const current = Array.isArray(state.answers[question.id])
                ? [...state.answers[question.id]]
                : [];
              if (input.checked) {
                current.push(option.id);
              } else {
                const index = current.indexOf(option.id);
                if (index >= 0) {
                  current.splice(index, 1);
                }
              }
              state.answers[question.id] = current;
              updateOptionDisabledStates(question);
              updateButtons(question);
            } else {
              state.answers[question.id] = option.id;
              updateButtons(question);
              if (state.index >= state.questions.length - 1) {
                submitQuestionnaire();
                return;
              }
              state.index += 1;
              renderQuestion();
              return;
            }
          });

          const span = document.createElement("span");
          span.textContent = option.label;

          label.appendChild(input);
          label.appendChild(span);
          optionsContainer.appendChild(label);
        });

        updateOptionDisabledStates(question);

        const total = state.questions.length;
        const step = state.index + 1;
        progressLabel.textContent = `Question ${step} of ${total}`;
        progressFill.style.width = `${(step / total) * 100}%`;

        updateButtons(question);
      };

      const updateButtons = (currentQuestion = null) => {
        const question = currentQuestion || state.questions[state.index];
        const total = state.questions.length;
        const answer = state.answers[question?.id];
        const hasAnswer = Array.isArray(answer) ? answer.length > 0 : Boolean(answer);
        const isSingle = question?.type !== "multi";

        prevButton.disabled = state.index === 0;
        nextButton.disabled = !hasAnswer || state.index >= total - 1;
        submitButton.disabled = !hasAnswer || state.index < total - 1;

        nextButton.classList.toggle(
          "hidden",
          state.index >= total - 1 || isSingle
        );
        submitButton.classList.toggle("hidden", state.index < total - 1 || isSingle);
      };

      prevButton.addEventListener("click", () => {
        if (state.index > 0) {
          state.index -= 1;
          renderQuestion();
        }
      });

      nextButton.addEventListener("click", () => {
        if (state.index < state.questions.length - 1) {
          state.index += 1;
          renderQuestion();
        }
      });

      questionnaire.addEventListener("submit", (event) => {
        event.preventDefault();
        submitQuestionnaire();
      });

      toggleDevPanel.addEventListener("click", () => {
        const isCollapsed = devPanel.classList.toggle("collapsed");
        toggleDevPanel.textContent = isCollapsed ? "Expand" : "Collapse";
      });

      startOverButton.addEventListener("click", () => {
        resetQuestionnaire();
      });

      loadQuestions().then((questions) => {
        state.questions = questions;
        renderQuestion();
      });

      loadTherapists().then((therapists) => {
        state.therapists = therapists;
      });
    </script>
  </body>
</html>
